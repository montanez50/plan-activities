import{q as S,r as x,j as e,a as C,y as M}from"./app-6475b0f9.js";import{B as y}from"./Button-68eb0cdd.js";import{I}from"./Input-5a4dde59.js";import{S as E}from"./Select-2b07d0f5.js";import{_ as N,g as L,A as P}from"./AppLayout-4b7a2500.js";import{T as c}from"./Table-95d326d9.js";import{I as F}from"./IconPlus-c76de2a6.js";import{I as W}from"./IconPencilPlus-5b1cb346.js";import{I as $}from"./IconTrash-cf7a1b16.js";import"./react-select.esm-e01f61b7.js";import"./createReactComponent-e81a252b.js";const z=({id:a,item:i,changeActivity:r,status:o,...l})=>{const[t,u]=x.useState(o),m=()=>{u(!t)};return x.useEffect(()=>{r(a,i,t)},[a,i,t,r]),e.jsx(c.TdNumber,{className:`px-2 ${t?"bg-green-600":""}`,onClick:()=>m(),...l})},R=({id:a,item:i,changeActivity:r})=>{const[o,l]=x.useState(i.name??""),t=u=>{l(u.target.value)};return x.useEffect(()=>{r(a,"text",o)},[a,o,r]),e.jsx(e.Fragment,{children:e.jsx(I,{id:`${a}-text`,name:`${a}-text`,value:o,onChange:t,className:"mt-1 block w-full",required:!0})})},_=({id:a,numbers:i,item:r,handleRemove:o,changeActivity:l})=>e.jsxs("tr",{children:[e.jsx(c.Td,{scope:"row",children:a+1}),e.jsx(c.Td,{children:e.jsx(R,{id:a,item:r,changeActivity:l})}),i.map((t,u)=>e.jsx(z,{id:a,item:t,changeActivity:l,status:r.days?r.days[t]:!1},u)),e.jsx(c.TdNumber,{children:e.jsx(y,{icon:e.jsx($,{strokeWidth:"1.5",size:"20"}),className:"bg-rose-200 text-rose-500 border border-rose-300 hover:border-rose-500 m-auto",noSubmit:1,onClick:()=>o(a)})})]}),B=({month:a,handleChange:i})=>{const{availableMonths:r}=S().props,l=[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiembre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}].filter(t=>r.includes(t.value));return e.jsx("div",{className:"my-2",children:e.jsx(E,{label:"Mes",options:l,value:l.filter(t=>t.value==a)[0],onChange:i})})},J=(a,i=null)=>{const r=[],o=[],l=["D","L","M","M","J","V","S"],t=new Date,u=i??t.getFullYear(),m=new Date(u,a,0).getDate(),f=Array(m).fill().map((h,b)=>b+1);t.setDate(1),t.setFullYear(u),t.setMonth(a-1);const j=t.getDay();for(let h=0;h<m;h++){let b=new Date(t),p=(j+h)%7;b.setDate(h+1),r.push(l[p]),(p===0||p===6)&&o.push(h+1)}return{monthDays:r,colorDays:o,numbers:f,year:u}};function O(){const{planification:a,activities:i,errors:r}=S().props,[o,l]=x.useState([]),[t,u]=x.useState(a.month),[m,f]=x.useState(i),{monthDays:j,colorDays:h,numbers:b,year:p}=J(t,a.year),k=s=>{u(s.value),l([])},D=s=>{const n=m.filter((g,d)=>d!==s),v=o.filter((g,d)=>d!==s);l(v),f(n)},w=()=>{const s=m[m.length-1]??-1,n=s.id??s;f([...m,n+1])},T=(s,n,v)=>{l(g=>{let d=g;return d[s]||(d[s]={}),d[s][n]||(d[s][n]=""),d[s][n]=v,d})},A=s=>{s.preventDefault(),o.length!==0?M.post(route("planification.update",a),{year:p,month:t,activities:o},{onSuccess:()=>{N.success("Planificación modificada correctamente!",{icon:"👏",style:{borderRadius:"10px",background:"#333",color:"#fff"}})}}):console.log("No hay planificaciones")};return x.useEffect(()=>{Object.entries(r).forEach(([s,n])=>{N.error(`${n}`)})},[r]),e.jsxs(e.Fragment,{children:[e.jsx(C,{title:"Editar Planificación"}),e.jsx("div",{className:"mb-5",children:e.jsx("div",{className:"flex flex-row items-center md:justify-between gap-5",children:e.jsx("div",{className:"w-full",children:e.jsx(B,{month:t,handleChange:k})})})}),e.jsx(c.Card,{title:"EDITAR PLANIFICACIÓN",icon:e.jsx(L,{strokeWidth:"1.5",size:"20"}),children:e.jsxs("form",{onSubmit:A,children:[e.jsxs(c,{children:[e.jsxs(c.Thead,{children:[e.jsxs("tr",{children:[e.jsx(c.Th,{rowSpan:2,scope:"col",children:"#"}),e.jsx(c.Th,{rowSpan:2,scope:"col",children:"Actividades"}),j.map((s,n)=>e.jsx(c.ThNumber,{scope:"col",className:` py-3 ${s==="S"||s==="D"?"bg-blue-600 dark:text-white":"bg-gray-100"}`,children:s},n)),e.jsx(c.ThNumber,{rowSpan:2,scope:"col",className:"py-3 bg-gray-100",children:e.jsx("svg",{className:"h-5 w-5 text-red-500 m-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("tr",{children:b.map((s,n)=>e.jsx(c.ThNumber,{scope:"col",className:` py-3 ${h.includes(s)?"bg-blue-600 dark:text-white":"bg-gray-100"}`,children:s},n))})]}),e.jsx(c.Tbody,{children:m.map((s,n)=>e.jsx(_,{id:n,item:s,numbers:b,handleRemove:D,changeActivity:T},s.id??s))})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-4 p-2",children:[e.jsx(y,{label:"Agregar",icon:e.jsx(F,{strokeWidth:"1.5",size:"20"}),className:"bg-gray-200 text-gray-500 border border-gray-300 hover:border-gray-500",onClick:w,noSubmit:1}),e.jsx(y,{label:"Guardar",icon:e.jsx(W,{strokeWidth:"1.5",size:"20"}),className:"bg-teal-200 text-teal-500 border border-teal-300 hover:border-teal-500"})]})]})})]})}O.layout=a=>e.jsx(P,{children:a});export{O as default};
