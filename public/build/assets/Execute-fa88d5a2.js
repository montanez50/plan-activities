import{q as F,r as h,j as e,a as I,y as L}from"./app-cf7ce22d.js";import{B as v}from"./Button-f3d83094.js";import{I as T}from"./Input-c090de6e.js";import{_ as S,h as _,A as W}from"./AppLayout-281e5e8d.js";import{T as l}from"./Table-3b1f3018.js";import{I as z}from"./IconPlus-142c703e.js";import{I as R}from"./IconPencilPlus-dc60b092.js";import{I as J}from"./IconTrash-80b30a03.js";import"./createReactComponent-7828f558.js";const O=({id:t,item:i,changeActivity:r,status:o,...d})=>{const[a,c]=h.useState(o??!1),m=()=>{c(!a)};return h.useEffect(()=>{r(t,i,a)},[t,i,a,r]),e.jsx(l.TdNumber,{className:` ${a?"bg-cyan-400":""}`,onClick:()=>m(),...d})},B=({id:t,item:i,changeActivity:r})=>{const[o,d]=h.useState(i.name??""),a=c=>{d(c.target.value)};return h.useEffect(()=>{r(t,"text",o)},[t,o,r]),e.jsx(e.Fragment,{children:e.jsx(T,{id:`${t}-text`,name:`${t}-text`,value:o,onChange:a,className:"mt-1 block w-full",required:!0})})},V=({id:t,numbers:i,item:r,handleRemove:o,changeActivity:d})=>e.jsxs("tr",{children:[e.jsx(l.Td,{scope:"row",children:t+1}),e.jsx(l.Td,{children:e.jsx(B,{id:t,item:r,changeActivity:d})}),i.map((a,c)=>e.jsx(O,{id:t,item:a,changeActivity:d,status:r.days_execute?r.days_execute[a]:!1},c)),e.jsx(l.TdNumber,{children:e.jsx(v,{icon:e.jsx(J,{strokeWidth:"1.5",size:"20"}),className:"bg-rose-200 text-rose-500 border border-rose-300 hover:border-rose-500 m-auto",noSubmit:1,onClick:()=>o(t)})})]}),q=({id:t,item:i,changeActivity:r,status:o,...d})=>{const[a,c]=h.useState(o??!1),m=()=>{c(!a)};return h.useEffect(()=>{r(t,i,a)},[t,i,a,r]),e.jsx(l.TdNumber,{className:` ${a?"bg-cyan-400":""}`,onClick:()=>m(),...d})},Y=({id:t,item:i,changeActivity:r})=>{const[o,d]=h.useState(i.id??""),a=c=>{d(c.target.value)};return h.useEffect(()=>{r(t,"id",o)},[t,o,r]),e.jsx(e.Fragment,{children:e.jsx(T,{id:`${t}-id`,name:`${t}-id`,value:o,onChange:a,className:"mt-1 block w-full",type:"hidden"})})},G=({id:t,numbers:i,item:r,handleRemove:o,changeActivity:d})=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx(l.Td,{scope:"row",rowSpan:2,children:t+1}),e.jsxs(l.Td,{rowSpan:2,children:[r.name," ",e.jsx(Y,{id:t,item:r,changeActivity:d})]}),i.map((a,c)=>e.jsx(l.TdNumber,{className:` ${r.days&&r.days[a]?"bg-green-600":""}`},c)),e.jsx(l.TdNumber,{rowSpan:2,className:"py-4 text-white",children:"X"})]}),e.jsx("tr",{children:i.map((a,c)=>e.jsx(q,{id:t,item:a,changeActivity:d,status:r.days_execute?r.days_execute[a]:!1},c))})]}),H=(t,i=null)=>{const r=[],o=[],d=["D","L","M","M","J","V","S"],a=new Date,c=i??a.getFullYear(),m=new Date(c,t,0).getDate(),g=Array(m).fill().map((j,x)=>x+1);a.setDate(1),a.setFullYear(c),a.setMonth(t-1);const y=a.getDay();for(let j=0;j<m;j++){let x=new Date(a),p=(y+j)%7;x.setDate(j+1),r.push(d[p]),(p===0||p===6)&&o.push(j+1)}return{monthDays:r,colorDays:o,numbers:g,year:c}};function U(){const{planification:t,activities:i,noPlanActivities:r,errors:o}=F().props,[d,a]=h.useState([]),[c,m]=h.useState([]),g=t.month,[y,j]=h.useState(i),[x,p]=h.useState(r),{monthDays:w,colorDays:k,numbers:N,year:C}=H(g,t.year),D=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],A=s=>{const n=x.filter((b,u)=>u!==s),f=c.filter((b,u)=>u!==s);m(f),p(n)},P=()=>{const s=x[x.length-1]??-1,n=s.id??s;p([...x,n+1])},E=(s,n,f)=>{a(b=>{let u=b;return u[s]||(u[s]={}),u[s][n]||(u[s][n]=""),u[s][n]=f,u})},M=(s,n,f)=>{m(b=>{let u=b;return u[s]||(u[s]={}),u[s][n]||(u[s][n]=""),u[s][n]=f,u})},$=s=>{s.preventDefault(),d.length!==0?L.post(route("planification.executePlan",t),{activities:d,noPlanActivities:c},{onSuccess:()=>{S.success("Planificación ejecutada correctamente!",{icon:"👏",style:{borderRadius:"10px",background:"#333",color:"#fff"}})}}):console.log("No hay planificaciones")};return h.useEffect(()=>{Object.entries(o).forEach(([s,n])=>{S.error(`${n}`)})},[o]),e.jsxs(e.Fragment,{children:[e.jsx(I,{title:"Editar Planificación"}),e.jsx("div",{className:"mb-5",children:e.jsx("div",{className:"flex flex-row items-center md:justify-between gap-5",children:e.jsx("div",{className:"w-full",children:e.jsxs("h3",{className:"font-semibold text-l text-gray-800 leading-tight mb-2",children:["Mes de ",D[g-1]," del ",C]})})})}),e.jsx(l.Card,{title:"EJECUTAR PLANIFICACIÓN",icon:e.jsx(_,{strokeWidth:"1.5",size:"20"}),children:e.jsxs("form",{onSubmit:$,children:[e.jsxs(l,{children:[e.jsxs(l.Thead,{children:[e.jsxs("tr",{children:[e.jsx(l.Th,{rowSpan:2,scope:"col",children:"#"}),e.jsx(l.Th,{rowSpan:2,scope:"col",children:"Actividades"}),w.map((s,n)=>e.jsx(l.ThNumber,{scope:"col",className:` py-3 ${s==="S"||s==="D"?"bg-blue-600 dark:text-white":"bg-gray-100"}`,children:s},n)),e.jsx(l.ThNumber,{rowSpan:2,scope:"col",className:"py-3 bg-gray-100",children:e.jsx("svg",{className:"h-5 w-5 text-red-500 m-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("tr",{children:N.map((s,n)=>e.jsx(l.ThNumber,{scope:"col",className:` py-3 ${k.includes(s)?"bg-blue-600 dark:text-white":"bg-gray-100"}`,children:s},n))})]}),e.jsxs(l.Tbody,{children:[y.map((s,n)=>e.jsx(G,{id:n,item:s,numbers:N,handleRemove:A,changeActivity:E},s.id??s)),e.jsx("tr",{children:e.jsx(l.Td,{className:"bg-gray-100",colSpan:35,children:"ACTIVIDADES NO PLANIFICADAS"})}),x.length?x.map((s,n)=>e.jsx(V,{id:n,item:s,numbers:N,handleRemove:A,changeActivity:M},s.id??s)):e.jsx("tr",{children:e.jsx(l.Td,{className:"text-center",colSpan:35,children:"No hay actividades"})})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-4 p-2",children:[e.jsx(v,{label:"Agregar",icon:e.jsx(z,{strokeWidth:"1.5",size:"20"}),className:"bg-gray-200 text-gray-500 border border-gray-300 hover:border-gray-500",onClick:P,noSubmit:1}),e.jsx(v,{label:"Guardar",icon:e.jsx(R,{strokeWidth:"1.5",size:"20"}),className:"bg-teal-200 text-teal-500 border border-teal-300 hover:border-teal-500"})]})]})})]})}U.layout=t=>e.jsx(W,{children:t});export{U as default};
