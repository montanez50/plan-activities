import{q as A,r as x,j as e,a as C,y as M}from"./app-fbac857a.js";import{B as y}from"./Button-429df1c9.js";import{I}from"./Input-554d95c0.js";import{S as E}from"./Select-7b2120fa.js";import{_ as N,h as L,A as P}from"./AppLayout-cc157e47.js";import{T as n}from"./Table-8bfe4792.js";import{I as F}from"./IconPlus-f84e897e.js";import{I as W}from"./IconPencilPlus-69ec0e00.js";import{I as $}from"./IconTrash-05d0a7be.js";import"./react-select.esm-8b7c4e16.js";import"./createReactComponent-a8208e3e.js";const z=({id:t,item:c,changeActivity:r,status:o,...i})=>{const[a,u]=x.useState(o),m=()=>{u(!a)};return x.useEffect(()=>{r(t,c,a)},[t,c,a,r]),e.jsx(n.TdNumber,{className:`px-2 ${a?"bg-green-600":""}`,onClick:()=>m(),...i})},R=({id:t,item:c,changeActivity:r})=>{const[o,i]=x.useState(c.name??""),a=u=>{i(u.target.value)};return x.useEffect(()=>{r(t,"text",o)},[t,o,r]),e.jsx(e.Fragment,{children:e.jsx(I,{id:`${t}-text`,name:`${t}-text`,value:o,onChange:a,className:"mt-1 block w-full",required:!0})})},_=({id:t,numbers:c,item:r,handleRemove:o,changeActivity:i})=>e.jsxs("tr",{children:[e.jsx(n.Td,{scope:"row",children:t+1}),e.jsx(n.Td,{children:e.jsx(R,{id:t,item:r,changeActivity:i})}),c.map((a,u)=>e.jsx(z,{id:t,item:a,changeActivity:i,status:r.days?r.days[a]:!1},u)),e.jsx(n.TdNumber,{children:e.jsx(y,{icon:e.jsx($,{strokeWidth:"1.5",size:"20"}),className:"bg-rose-200 text-rose-500 border border-rose-300 hover:border-rose-500 m-auto",noSubmit:1,onClick:()=>o(t)})})]}),B=({month:t,handleChange:c})=>{const r=[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiembre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}];return e.jsx("div",{className:"my-2",children:e.jsx(E,{label:"Mes",options:r,value:r.filter(o=>o.value==t)[0],onChange:c})})},J=(t,c=null)=>{const r=[],o=[],i=["D","L","M","M","J","V","S"],a=new Date,u=c??a.getFullYear(),m=new Date(u,t,0).getDate(),f=Array(m).fill().map((h,b)=>b+1);a.setDate(1),a.setFullYear(u),a.setMonth(t-1);const j=a.getDay();for(let h=0;h<m;h++){let b=new Date(a),p=(j+h)%7;b.setDate(h+1),r.push(i[p]),(p===0||p===6)&&o.push(h+1)}return{monthDays:r,colorDays:o,numbers:f,year:u}};function O(){const{planification:t,activities:c,errors:r}=A().props,[o,i]=x.useState([]),[a,u]=x.useState(t.month),[m,f]=x.useState(c),{monthDays:j,colorDays:h,numbers:b,year:p}=J(a,t.year),S=s=>{u(s.value),i([])},k=s=>{const l=m.filter((v,d)=>d!==s),g=o.filter((v,d)=>d!==s);i(g),f(l)},D=()=>{const s=m[m.length-1]??-1,l=s.id??s;f([...m,l+1])},w=(s,l,g)=>{i(v=>{let d=v;return d[s]||(d[s]={}),d[s][l]||(d[s][l]=""),d[s][l]=g,d})},T=s=>{s.preventDefault(),o.length!==0?M.post(route("planification.update",t),{year:p,month:a,activities:o},{onSuccess:()=>{N.success("Planificación modificada correctamente!",{icon:"👏",style:{borderRadius:"10px",background:"#333",color:"#fff"}})}}):console.log("No hay planificaciones")};return x.useEffect(()=>{Object.entries(r).forEach(([s,l])=>{N.error(`${l}`)})},[r]),e.jsxs(e.Fragment,{children:[e.jsx(C,{title:"Editar Planificación"}),e.jsx("div",{className:"mb-5",children:e.jsx("div",{className:"flex flex-row items-center md:justify-between gap-5",children:e.jsx("div",{className:"w-full",children:e.jsx(B,{month:a,handleChange:S})})})}),e.jsx(n.Card,{title:"EDITAR PLANIFICACIÓN",icon:e.jsx(L,{strokeWidth:"1.5",size:"20"}),children:e.jsxs("form",{onSubmit:T,children:[e.jsxs(n,{children:[e.jsxs(n.Thead,{children:[e.jsxs("tr",{children:[e.jsx(n.Th,{rowSpan:2,scope:"col",children:"#"}),e.jsx(n.Th,{rowSpan:2,scope:"col",children:"Actividades"}),j.map((s,l)=>e.jsx(n.ThNumber,{scope:"col",className:` py-3 ${s==="S"||s==="D"?"bg-blue-600 dark:text-white":"bg-gray-100"}`,children:s},l)),e.jsx(n.ThNumber,{rowSpan:2,scope:"col",className:"py-3 bg-gray-100",children:e.jsx("svg",{className:"h-5 w-5 text-red-500 m-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("tr",{children:b.map((s,l)=>e.jsx(n.ThNumber,{scope:"col",className:` py-3 ${h.includes(s)?"bg-blue-600 dark:text-white":"bg-gray-100"}`,children:s},l))})]}),e.jsx(n.Tbody,{children:m.map((s,l)=>e.jsx(_,{id:l,item:s,numbers:b,handleRemove:k,changeActivity:w},s.id??s))})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-4 p-2",children:[e.jsx(y,{label:"Agregar",icon:e.jsx(F,{strokeWidth:"1.5",size:"20"}),className:"bg-gray-200 text-gray-500 border border-gray-300 hover:border-gray-500",onClick:D,noSubmit:1}),e.jsx(y,{label:"Guardar",icon:e.jsx(W,{strokeWidth:"1.5",size:"20"}),className:"bg-teal-200 text-teal-500 border border-teal-300 hover:border-teal-500"})]})]})})]})}O.layout=t=>e.jsx(P,{children:t});export{O as default};
